<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Surroundings</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* General table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            table-layout: fixed; /* Ensures the columns align properly */
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            word-wrap: break-word; /* Ensures text wraps in the address column */
        }

        th {
            font-weight: bold;
            background-color: #f3f4f6;
            color: #333;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        td {
            font-size: 14px;
            color: #4a4a4a;
        }

        tr:hover {
            background-color: #f9fafb;
            transition: background-color 0.3s ease;
        }

        /* Scrollable body */
        .scrollable-table-container {
            max-height: 300px;
            overflow-y: auto;
            display: block;
        }

        .scrollable-table-container table {
            border-collapse: collapse;
            width: 100%;
        }

        td.address-column {
            white-space: normal;
            word-wrap: break-word;
        }

        /* Map dimensions */
        #map {
            height: 500px;
            width: 100%;
            border-radius: 12px;
        }

        /* Styling for toggle checkbox */
        .toggle-checkbox:checked {
            background-color: #48bb78;
        }

        thead th {
            position: sticky;
            top: 0;
            background-color: #f3f4f6;
            z-index: 1;
        }

        th:nth-child(1), td:nth-child(1) {
            width: 15%; /* Name column */
        }
        th:nth-child(2), td:nth-child(2) {
            width: 30%; /* Address column */
        }
        th:nth-child(3), td:nth-child(3) {
            width: 10%; /* Rating column */
        }
        th:nth-child(4), td:nth-child(4) {
            width: 15%; /* User Ratings column */
        }
        th:nth-child(5), td:nth-child(5) {
            width: 15%; /* Travel Distance column */
        }
        th:nth-child(6), td:nth-child(6) {
            width: 15%; /* Travel Time column */
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto px-6 py-10">
        <!-- Map section -->
        <div class="bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl shadow-lg p-8 mb-10">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Location Map</h2>

            <!-- Toggle for Traffic -->
            <div class="flex items-center mb-6">
                <label for="trafficToggle" class="mr-4 text-lg text-gray-600 font-semibold">Show Traffic Map:</label>
                <input type="checkbox" id="trafficToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full focus:outline-none transition-colors duration-300">
            </div>

            <!-- Toggles for Different Categories -->
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="flex items-center">
                    <label for="competitorsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Competitors (Blue)</label>
                    <input type="checkbox" id="competitorsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="supermarketsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Supermarkets (Green)</label>
                    <input type="checkbox" id="supermarketsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="publicServicesToggle" class="mr-4 text-lg text-gray-600 font-semibold">Public Services (Red)</label>
                    <input type="checkbox" id="publicServicesToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="restaurantsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Restaurants (Yellow)</label>
                    <input type="checkbox" id="restaurantsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="retailsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Retails (Purple)</label>
                    <input type="checkbox" id="retailsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="residentialsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Residentials (White)</label>
                    <input type="checkbox" id="residentialsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="educationsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Educational Institutes (Black)</label>
                    <input type="checkbox" id="educationsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="touristsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Tourist Places (Grey)</label>
                    <input type="checkbox" id="touristsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="corporatesToggle" class="mr-4 text-lg text-gray-600 font-semibold">Corporate Offices (Orange)</label>
                    <input type="checkbox" id="corporatesToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>
                <div class="flex items-center">
                    <label for="hotelsToggle" class="mr-4 text-lg text-gray-600 font-semibold">Hotels (White)</label>
                    <input type="checkbox" id="hotelsToggle" class="toggle-checkbox w-10 h-6 bg-gray-300 rounded-full">
                </div>

                
            </div>

            <!-- Google Maps -->
            <div id="map" class="w-full h-96 border-2 border-gray-300"></div>
        </div>

        <!-- Category summary table -->
        <div>
            <table class="w-full text-left">
                <thead class="bg-gradient-to-r from-gray-500 to-gray-600 text-white">
                    <tr>
                        <th>Category</th>
                        <th>Nearby</th>
                    </tr>
                </thead>
                <tbody class="text-gray-700">
                    <tr>
                        <td>Competitors</td>
                        <td id="competitorsCount">0</td>
                    </tr>
                    <tr>
                        <td>Public Services</td>
                        <td id="publicServicesCount">0</td>
                    </tr>
                    <tr>
                        <td>Restaurants</td>
                        <td id="restaurantsCount">0</td>
                    </tr>
                    <tr>
                        <td>Residentials</td>
                        <td id="residentialsCount">0</td>
                    </tr>
                    <tr>
                        <td>Supermarkets</td>
                        <td id="mallsCount">0</td>
                    </tr>
                    <tr>
                        <td>Big Retail Shops</td>
                        <td id="retailShopsCount">0</td>
                    </tr>
                    <tr>
                        <td>Hotels</td>
                        <td id="hotelsCount">0</td>
                    </tr>
                    <tr>
                        <td>Educational Institues</td>
                        <td id="educationCount">0</td>
                    </tr>
                    <tr>
                        <td>Tourist Places</td>
                        <td id="touristCount">0</td>
                    </tr>
                    <tr>
                        <td>Corporate Offices</td>
                        <td id="corporateCount">0</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Competitors Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Competitors</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                        <tr>
                            <th>Name</th>
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for competition in competitors %}
                        <tr>
                            <td>{{ competition.name }}</td>
                            <td>{{ competition.rating }}</td>
                            <td>{{ competition.user_rating }}</td>
                            <td>{{ competition.Travel_Distance }}</td>
                            <td>{{ competition.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby competitors found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Supermarkets Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Supermarkets</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-green-500 to-teal-600 text-white">
                        <tr>
                            <th>Name</th>
                            <!-- <th>Address</th> -->
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for supermarket in supermarkets %}
                        <tr>
                            <td>{{ supermarket.name }}</td>
                            <!-- <td class="address-column">{{ supermarket.address }}</td> -->
                            <td>{{ supermarket.rating }}</td>
                            <td>{{ supermarket.user_rating }}</td>
                            <td>{{ supermarket.Travel_Distance }}</td>
                            <td>{{ supermarket.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby supermarkets found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Public Services Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Public Services</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-red-500 to-pink-600 text-white">
                        <tr>
                            <th>Name</th>
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for publicservice in publicservices %}
                        <tr>
                            <td>{{ publicservice.name }}</td>
                            <td>{{ publicservice.rating }}</td>
                            <td>{{ publicservice.user_rating }}</td>
                            <td>{{ publicservice.Travel_Distance }}</td>
                            <td>{{ publicservice.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby public services found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Restaurants Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Restaurants</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white">
                        <tr>
                            <th>Name</th>
                  
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for restaurant in restaurants %}
                        <tr>
                            <td>{{ restaurant.name }}</td>
                            <td>{{ restaurant.rating }}</td>
                            <td>{{ restaurant.user_rating }}</td>
                            <td>{{ restaurant.Travel_Distance }}</td>
                            <td>{{ restaurant.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby restaurants found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Retails Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Retails</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white">
                        <tr>
                            <th>Name</th>
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for retail in retails %}
                        <tr>
                            <td>{{ retail.name }}</td>
                            <td>{{ retail.rating }}</td>
                            <td>{{ retail.user_rating }}</td>
                            <td>{{ retail.Travel_Distance }}</td>
                            <td>{{ retail.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby retails found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Residential Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Residentials</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                        <tr>
                            <th>Name</th>
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for resident in residentials %}
                        <tr>
                            <td>{{ resident.name }}</td>
                            <td>{{ resident.rating }}</td>
                            <td>{{ resident.user_rating }}</td>
                            <td>{{ resident.Travel_Distance }}</td>
                            <td>{{ resident.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby residentials found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Hotels Table -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Hotels</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                        <tr>
                            <th>Name</th>
                            <!-- <th>Address</th> -->
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for hotel in hotels %}
                        <tr>
                            <td>{{ hotel.name }}</td>
                            <!-- <td class="address-column">{{ apartment.address }}</td> -->
                            <td>{{ hotel.rating }}</td>
                            <td>{{ hotel.user_rating }}</td>
                            <td>{{ hotel.Travel_Distance }}</td>
                            <td>{{ hotel.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby hotels found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Education Table -->

        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Education</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                        <tr>
                            <th>Name</th>
                            <!-- <th>Address</th> -->
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for edu in educations %}
                        <tr>
                            <td>{{ edu.name }}</td>
                            <!-- <td class="address-column">{{ apartment.address }}</td> -->
                            <td>{{ edu.rating }}</td>
                            <td>{{ edu.user_rating }}</td>
                            <td>{{ edu.Travel_Distance }}</td>
                            <td>{{ edu.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby Education found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tourist -->

        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Tourist Places</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                        <tr>
                            <th>Name</th>
                            <!-- <th>Address</th> -->
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for tour in tourists %}
                        <tr>
                            <td>{{ tour.name }}</td>
                            <!-- <td class="address-column">{{ apartment.address }}</td> -->
                            <td>{{ tour.rating }}</td>
                            <td>{{ tour.user_rating }}</td>
                            <td>{{ tour.Travel_Distance }}</td>
                            <td>{{ tour.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby Tourist found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


        <!-- corporate table -->

        <div class="bg-white rounded-xl shadow-lg p-8 mb-10 transition-all hover:shadow-2xl">
            <h2 class="text-3xl font-semibold text-gray-800 mb-6">Corporate Offices</h2>
            <div>
                <table>
                    <thead class="bg-gradient-to-r from-pink-500 to-purple-600 text-white">
                        <tr>
                            <th>Name</th>
                            <!-- <th>Address</th> -->
                            <th>Rating</th>
                            <th>User Ratings</th>
                            <th>Travel Distance</th>
                            <th>Travel Time</th>
                        </tr>
                    </thead>
                </table>
            </div>
            <div class="scrollable-table-container">
                <table>
                    <tbody class="text-gray-700">
                        {% for corp in corporates %}
                        <tr>
                            <td>{{ corp.name }}</td>
                            <!-- <td class="address-column">{{ apartment.address }}</td> -->
                            <td>{{ corp.rating }}</td>
                            <td>{{ corp.user_rating }}</td>
                            <td>{{ corp.Travel_Distance }}</td>
                            <td>{{ corp.Travel_Time }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="py-5 text-center text-gray-500">No nearby Corporate office found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>


    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCNJ0iv-Why9tmFmkTZrIVPp_B_qMZYQpg&libraries=places"></script>
<script>
    let map, trafficLayer;
    let markers = {
        competitors: [],
        supermarkets: [],
        publicServices: [],
        restaurants: [],
        retails: [],
        residentials: [],
        tourists: [],
        educations: [],
        hotels: [],
        corporates: []
    };

    function initializeMap(center) {
        const mapOptions = {
            center: center,
            zoom: 15
        };

        map = new google.maps.Map(document.getElementById('map'), mapOptions);

        const sourceMarker = new google.maps.Marker({
            position: center,
            map: map,
            title: 'Source Location',
            label: 'S'
        });

        trafficLayer = new google.maps.TrafficLayer();
    }

    function toggleTraffic(showTraffic) {
        if (showTraffic) {
            trafficLayer.setMap(map);
        } else {
            trafficLayer.setMap(null);
        }
    }

    function addMarker(map, lat, lng, title, travelDistance, travelTime, markerColor, category) {
        const marker = new google.maps.Marker({
            position: { lat: lat, lng: lng },
            map: map,
            title: `${title} - Distance: ${travelDistance}, Time: ${travelTime}`,
            icon: `https://raw.githubusercontent.com/Concept211/Google-Maps-Markers/master/images/marker_${markerColor}.png`
        });

        const infoWindow = new google.maps.InfoWindow({
            content: `<div><strong>${title}</strong><br>Travel Time: ${travelTime}<br>Travel Distance: ${travelDistance}</div>`
        });

        marker.addListener('click', function () {
            infoWindow.open(map, marker);
        });

        markers[category].push(marker); // Store marker for later toggling
    }

    function loadMarkers(data, markerColor, category) {
        if (data && data.length > 0) {
            data.forEach(function (location) {
                const coordinatesStr = location.coordinates.replace('(', '').replace(')', '');
                const coordinatesArr = coordinatesStr.split(',');

                const lat = parseFloat(coordinatesArr[0].trim());
                const lng = parseFloat(coordinatesArr[1].trim());

                addMarker(map, lat, lng, location.name, location.Travel_Distance, location.Travel_Time, markerColor, category);
            });
        }
    }

    function toggleCategoryMarkers(category, showMarkers) {
        markers[category].forEach(marker => {
            marker.setMap(showMarkers ? map : null);
        });
    }

    // Event listeners for toggles
    document.getElementById('trafficToggle').addEventListener('change', function () {
        toggleTraffic(this.checked);
    });

    document.getElementById('competitorsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('competitors', this.checked);
    });

    document.getElementById('supermarketsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('supermarkets', this.checked);
    });

    document.getElementById('publicServicesToggle').addEventListener('change', function () {
        toggleCategoryMarkers('publicServices', this.checked);
    });

    document.getElementById('restaurantsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('restaurants', this.checked);
    });

    document.getElementById('retailsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('retails', this.checked);
    });

    document.getElementById('residentialsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('residentials', this.checked);
    });

    document.getElementById('educationsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('educations', this.checked);
    });

    document.getElementById('touristsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('tourists', this.checked);
    });

    document.getElementById('corporatesToggle').addEventListener('change', function () {
        toggleCategoryMarkers('corporates', this.checked);
    });

    document.getElementById('hotelsToggle').addEventListener('change', function () {
        toggleCategoryMarkers('hotels', this.checked);
    });

    // Example source location initialization
    const sourceLat = parseFloat("{{ sourcelocation.0.Source_lat|floatformat:'6' }}");
    const sourceLng = parseFloat("{{ sourcelocation.0.Source_lon|floatformat:'6' }}");
    const sourceCenter = { lat: sourceLat, lng: sourceLng };

    // Initialize the map
    initializeMap(sourceCenter);

    // Load data from different categories with unique colors
    const competitors = {{ competitors_json|safe }};
    const supermarkets = {{ supermarkets_json|safe }};
    const publicServices = {{ publicservices_json|safe }};
    const restaurants = {{ restaurants_json|safe }};
    const retails = {{ retails_json|safe }};
    const residentials = {{ residentials_json|safe }};
    const hotels = {{ hotels_json|safe }};
    const educations = {{ educations_json|safe }};
    const tourists = {{ tourists_json|safe }};
    const corporates = {{ corporates_json|safe }};

    // Update summary table counts
    document.getElementById('competitorsCount').textContent = competitors.length || 0;
    document.getElementById('publicServicesCount').textContent = publicServices.length || 0;
    document.getElementById('restaurantsCount').textContent = restaurants.length || 0;
    document.getElementById('residentialsCount').textContent = residentials.length || 0;
    document.getElementById('mallsCount').textContent = supermarkets.length || 0;
    document.getElementById('retailShopsCount').textContent = retails.length || 0;
    document.getElementById('hotelsCount').textContent = hotels.length || 0;
    document.getElementById('touristCount').textContent = tourists.length || 0;
    document.getElementById('educationCount').textContent = educations.length || 0;
    document.getElementById('corporateCount').textContent = corporates.length || 0;

    // Preload all markers but keep them hidden until toggled on
    loadMarkers(competitors, 'blue', 'competitors');
    loadMarkers(supermarkets, 'green', 'supermarkets');
    loadMarkers(publicServices, 'red', 'publicServices');
    loadMarkers(restaurants, 'yellow', 'restaurants');
    loadMarkers(retails, 'purple', 'retails');
    loadMarkers(residentials, 'white', 'residentials');
    loadMarkers(educations, 'black', 'educations');
    loadMarkers(tourists, 'grey', 'tourists');
    loadMarkers(corporates, 'orange', 'corporates');
    loadMarkers(hotels, 'white', 'hotels');
</script>


</body>
</html>